<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Least Squares Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --teal: #006D77;
    --teal-mid: #14a3a8;
    --teal-light: #83C5BE;
    --teal-bg: #e8f6f6;
    --yellow: #FFD166;
    --yellow-light: #fff8e6;
    --red: #d9534f;
    --text: #333;
    --text-light: #666;
    --white: #fff;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Source Sans Pro', sans-serif; background: #fafafa; color: var(--text); }
  .bar-top { height: 5px; background: linear-gradient(90deg, var(--yellow), var(--teal-mid), var(--teal)); }
  .bar-bot { height: 5px; background: linear-gradient(90deg, var(--teal), var(--teal-mid), var(--yellow)); margin-top: 32px; }

  .wrap { max-width: 1060px; margin: 0 auto; padding: 20px 28px 40px; }

  h1 { font-size: 28px; font-weight: 700; color: var(--teal); margin-bottom: 6px; }
  .hint { font-size: 14px; color: var(--text-light); margin-bottom: 20px; }
  .hint strong { color: var(--teal); }

  .grid { display: grid; grid-template-columns: 1fr 300px; gap: 24px; align-items: start; }
  @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }

  /* Plot */
  .plot { background: var(--white); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); padding: 16px; }
  .eq { text-align: center; font-size: 16px; color: var(--text-light); margin-bottom: 4px; }
  .eq b { color: var(--teal); font-size: 18px; }
  svg#chart { width: 100%; height: auto; display: block; }

  /* Controls */
  .ctrl { background: var(--white); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); padding: 20px; }
  .sg { margin-bottom: 16px; }
  .sg-head { display: flex; justify-content: space-between; margin-bottom: 5px; }
  .sg-head span { font-weight: 600; font-size: 14px; }
  .sg-val { font-weight: 700; font-size: 17px; color: var(--teal); text-align: right; min-width: 55px; }
  input[type="range"] { -webkit-appearance: none; width: 100%; height: 5px; border-radius: 3px; background: #e0e0e0; outline: none; }
  input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--teal); cursor: pointer; border: 2px solid var(--white); box-shadow: 0 1px 3px rgba(0,0,0,0.25); }
  input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; border-radius: 50%; background: var(--teal); cursor: pointer; border: 2px solid var(--white); }
  .sg-range { display: flex; justify-content: space-between; font-size: 11px; color: #aaa; margin-top: 2px; }

  /* SSR box */
  .ssr { background: var(--teal); border-radius: 8px; padding: 14px; text-align: center; margin: 16px 0 14px; }
  .ssr-label { color: rgba(255,255,255,0.7); font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; }
  .ssr-val { color: var(--yellow); font-size: 34px; font-weight: 700; line-height: 1.15; }
  .ssr-note { color: rgba(255,255,255,0.5); font-size: 12px; margin-top: 3px; }
  .ssr-note b { color: rgba(255,255,255,0.8); }

  /* Buttons */
  .btns { display: flex; gap: 6px; }
  .btn { flex: 1; padding: 9px 6px; border: none; border-radius: 7px; font-family: inherit; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.12s; }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
  .btn-y { background: var(--yellow); color: #333; }
  .btn-o { background: transparent; border: 2px solid var(--teal-light); color: var(--teal); }

  /* Toggle */
  .tog { display: flex; align-items: center; gap: 8px; margin-top: 14px; padding-top: 12px; border-top: 1px solid #eee; }
  .tog label { font-size: 13px; color: var(--text-light); cursor: pointer; user-select: none; }
  .sw { position: relative; width: 38px; height: 22px; background: #ccc; border-radius: 11px; cursor: pointer; transition: background 0.2s; flex-shrink: 0; }
  .sw.on { background: var(--teal-mid); }
  .sw::after { content: ''; position: absolute; top: 3px; left: 3px; width: 16px; height: 16px; border-radius: 50%; background: white; transition: transform 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
  .sw.on::after { transform: translateX(16px); }

  /* Presets */
  .presets { display: flex; gap: 5px; margin-top: 14px; padding-top: 12px; border-top: 1px solid #eee; flex-wrap: wrap; }
  .presets span { font-size: 12px; font-weight: 600; color: var(--text-light); width: 100%; margin-bottom: 2px; }
  .pre { padding: 5px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; border: 1.5px solid #ddd; background: var(--white); color: var(--text-light); transition: all 0.12s; }
  .pre:hover { border-color: var(--teal-light); color: var(--teal); }

  /* Table */
  .tbl { margin-top: 24px; }
  .tbl h2 { font-size: 17px; font-weight: 700; color: var(--teal); margin-bottom: 8px; }
  .tw { background: var(--white); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); overflow: hidden; }
  table { width: 100%; border-collapse: collapse; font-size: 14px; }
  thead { background: var(--teal); color: white; }
  th { padding: 10px 14px; font-weight: 600; text-align: right; font-size: 12px; text-transform: uppercase; letter-spacing: 0.4px; }
  th:first-child { text-align: center; width: 50px; }
  td { padding: 8px 14px; text-align: right; border-bottom: 1px solid #f0f0f0; font-variant-numeric: tabular-nums; }
  td:first-child { text-align: center; font-weight: 700; color: var(--teal); }
  tr:last-child td { border-bottom: none; }
  .pos { color: var(--teal); }
  .neg { color: var(--red); }
  .tot td { background: var(--yellow-light); font-weight: 700; border-top: 2px solid var(--yellow); border-bottom: none; }
</style>
</head>
<body>

<div class="bar-top"></div>
<div class="wrap">

  <h1>Finding the "Best" Line</h1>
  <p class="hint">Drag the sliders to fit a line. <strong>Goal:</strong> minimize the sum of squared residuals.</p>

  <div class="grid">

    <div class="plot">
      <div class="eq">weight = <b id="eq-int">-8.00</b> + <b id="eq-sl">0.30</b> × weeks</div>
      <svg id="chart" viewBox="0 0 600 420"></svg>
    </div>

    <div class="ctrl">

      <div class="sg">
        <div class="sg-head">
          <span>Slope (tilt)</span>
          <span class="sg-val" id="sl-v">0.300</span>
        </div>
        <input type="range" id="sl" min="-0.3" max="1.2" step="0.005" value="0.30">
        <div class="sg-range"><span>−0.3</span><span>1.2</span></div>
      </div>

      <div class="sg">
        <div class="sg-head">
          <span>Height (shift up/down)</span>
          <span class="sg-val" id="ht-v">2.45</span>
        </div>
        <input type="range" id="ht" min="0" max="5" step="0.02" value="2.45">
        <div class="sg-range"><span>0</span><span>5</span></div>
      </div>

      <div class="ssr">
        <div class="ssr-label">Sum of Squared Residuals</div>
        <div class="ssr-val" id="ssr-val">—</div>
        <div class="ssr-note">Best possible: <b>1.81</b></div>
      </div>

      <div class="btns">
        <button class="btn btn-y" onclick="showBest()">Show Best Fit</button>
        <button class="btn btn-o" onclick="reset()">Reset</button>
      </div>

      <div class="tog">
        <div class="sw" id="sq-tog" onclick="togSq()"></div>
        <label onclick="togSq()">Show squared residual boxes</label>
      </div>

      <div class="presets">
        <span>Try a preset:</span>
        <div class="pre" onclick="loadPre(0)">Flat</div>
        <div class="pre" onclick="loadPre(1)">Steep</div>
        <div class="pre" onclick="loadPre(2)">Gentle</div>
        <div class="pre" onclick="loadPre(3)">Best fit</div>
      </div>

    </div>
  </div>

  <div class="tbl">
    <h2>Residuals</h2>
    <div class="tw">
      <table>
        <thead><tr><th>Baby</th><th>Weeks</th><th>Actual</th><th>Predicted</th><th>Residual</th><th>Residual²</th></tr></thead>
        <tbody id="tb"></tbody>
      </table>
    </div>
  </div>

</div>
<div class="bar-bot"></div>

<script>
const data = [
  {b:1,w:32,kg:1.65},{b:2,w:36,kg:2.67},{b:3,w:33,kg:2.18},{b:4,w:36,kg:3.83},
  {b:5,w:35,kg:2.53},{b:6,w:36,kg:2.64},{b:7,w:32,kg:1.06},{b:8,w:34,kg:3.06}
];
const BEST_SLOPE = 0.3863, BEST_INT = -10.7788;
// Mean weeks = 34.25 — the pivot point for the slope slider
const X_CENTER = 34.25;
// Best height at center: BEST_INT + BEST_SLOPE * 34.25 = -10.7788 + 13.2306 = 2.4518
const BEST_HEIGHT = BEST_INT + BEST_SLOPE * X_CENTER;

const presets = [
  {s: 0.0,   h: 2.45, label:"Flat"},
  {s: 0.8,   h: 2.45, label:"Steep"},
  {s: 0.15,  h: 2.45, label:"Gentle"},
  {s: BEST_SLOPE, h: BEST_HEIGHT, label:"Best"},
];

// Chart geometry
const M = {t:20,r:25,b:48,l:55}, CW = 600, CH = 420;
const pW = CW-M.l-M.r, pH = CH-M.t-M.b;
const xMin=30.5, xMax=37.5, yMin=-0.2, yMax=4.8;
function sx(v){return M.l+((v-xMin)/(xMax-xMin))*pW}
function sy(v){return M.t+pH-((v-yMin)/(yMax-yMin))*pH}

// State: slope + height at center of data
let slope = 0.30, height = 2.45, showSq = false;

// True intercept from reparametrization
function trueInt(){ return height - slope * X_CENTER; }
function pred(x){ return trueInt() + slope * x; }

const slEl=document.getElementById('sl'), htEl=document.getElementById('ht');
const slV=document.getElementById('sl-v'), htV=document.getElementById('ht-v');
const eqSl=document.getElementById('eq-sl'), eqInt=document.getElementById('eq-int');
const ssrEl=document.getElementById('ssr-val');
const tb=document.getElementById('tb'), chart=document.getElementById('chart');

function draw(){
  const ti = trueInt();
  const res = data.map(d=>{const p=pred(d.w); const r=d.kg-p; return {...d, p, r, r2:r*r}});
  const ssr = res.reduce((s,d)=>s+d.r2,0);
  let svg='';

  // bg
  svg+=`<rect x="${M.l}" y="${M.t}" width="${pW}" height="${pH}" fill="#f8fafa" rx="3"/>`;
  // grid
  for(let x=31;x<=37;x++) svg+=`<line x1="${sx(x)}" y1="${M.t}" x2="${sx(x)}" y2="${M.t+pH}" stroke="#eaeaea"/>`;
  for(let y=0;y<=4;y++) svg+=`<line x1="${M.l}" y1="${sy(y)}" x2="${M.l+pW}" y2="${sy(y)}" stroke="#eaeaea"/>`;
  // axes
  svg+=`<line x1="${M.l}" y1="${M.t+pH}" x2="${M.l+pW}" y2="${M.t+pH}" stroke="#aaa" stroke-width="1.5"/>`;
  svg+=`<line x1="${M.l}" y1="${M.t}" x2="${M.l}" y2="${M.t+pH}" stroke="#aaa" stroke-width="1.5"/>`;
  // ticks
  for(let x=31;x<=37;x++) svg+=`<text x="${sx(x)}" y="${M.t+pH+20}" text-anchor="middle" font-size="12" fill="#888" font-family="'Source Sans Pro',sans-serif">${x}</text>`;
  for(let y=0;y<=4;y++) svg+=`<text x="${M.l-10}" y="${sy(y)+4}" text-anchor="end" font-size="12" fill="#888" font-family="'Source Sans Pro',sans-serif">${y}</text>`;
  svg+=`<text x="${M.l+pW/2}" y="${CH-4}" text-anchor="middle" font-size="14" fill="#888" font-weight="600" font-family="'Source Sans Pro',sans-serif">Gestational Age (weeks)</text>`;
  svg+=`<text x="14" y="${M.t+pH/2}" text-anchor="middle" font-size="14" fill="#888" font-weight="600" font-family="'Source Sans Pro',sans-serif" transform="rotate(-90,14,${M.t+pH/2})">Birthweight (kg)</text>`;

  // squared boxes
  if(showSq){
    res.forEach(d=>{
      const px=sx(d.w), ya=sy(d.kg), yp=sy(d.p), side=Math.abs(ya-yp);
      if(side>2) svg+=`<rect x="${px}" y="${Math.min(ya,yp)}" width="${side}" height="${side}" fill="rgba(255,209,102,0.22)" stroke="#FFD166" stroke-width="1.5" rx="2"/>`;
    });
  }

  // residual lines
  res.forEach(d=>{
    const px=sx(d.w), ya=sy(d.kg), yp=sy(d.p);
    svg+=`<line x1="${px}" y1="${ya}" x2="${px}" y2="${yp}" stroke="${d.r>=0?'#006D77':'#d9534f'}" stroke-width="2" stroke-dasharray="4,3" opacity="0.65"/>`;
  });

  // regression line
  svg+=`<line x1="${sx(xMin)}" y1="${sy(pred(xMin))}" x2="${sx(xMax)}" y2="${sy(pred(xMax))}" stroke="#006D77" stroke-width="2.5" opacity="0.8"/>`;

  // data points
  res.forEach(d=>{
    svg+=`<circle cx="${sx(d.w)}" cy="${sy(d.kg)}" r="6.5" fill="#FFD166" stroke="#006D77" stroke-width="2.5"/>`;
  });

  chart.innerHTML=svg;

  // SSR
  ssrEl.textContent=ssr.toFixed(2);
  ssrEl.style.color = ssr/1.81<1.05?'#5cb85c':'#FFD166';

  // equation
  eqSl.textContent=slope.toFixed(3);
  eqInt.textContent=ti.toFixed(2);

  // table
  let rows=''; let sum2=0;
  res.forEach(d=>{
    sum2+=d.r2;
    rows+=`<tr><td>${d.b}</td><td>${d.w}</td><td>${d.kg.toFixed(2)}</td><td>${d.p.toFixed(2)}</td><td class="${d.r>=0?'pos':'neg'}">${d.r>=0?'+':''}${d.r.toFixed(2)}</td><td>${d.r2.toFixed(3)}</td></tr>`;
  });
  rows+=`<tr class="tot"><td colspan="4"></td><td>SUM →</td><td>${sum2.toFixed(2)}</td></tr>`;
  tb.innerHTML=rows;
}

function sync(){
  slope=parseFloat(slEl.value); height=parseFloat(htEl.value);
  slV.textContent=slope.toFixed(3); htV.textContent=height.toFixed(2);
  draw();
}
slEl.addEventListener('input',sync);
htEl.addEventListener('input',sync);

function set(s,h){
  slope=s; height=h;
  slEl.value=s; htEl.value=h;
  slV.textContent=s.toFixed(3); htV.textContent=h.toFixed(2);
  draw();
}

function showBest(){
  const s0=slope, h0=height; let n=0;
  const id=setInterval(()=>{
    n++; const t=n/30, e=t*t*(3-2*t);
    set(s0+(BEST_SLOPE-s0)*e, h0+(BEST_HEIGHT-h0)*e);
    if(n>=30) clearInterval(id);
  },18);
}

function reset(){ set(0.30, 2.45); }

function loadPre(i){ const p=presets[i]; set(p.s, p.h); }

function togSq(){
  showSq=!showSq;
  document.getElementById('sq-tog').classList.toggle('on',showSq);
  draw();
}

sync();
</script>
</body>
</html>
